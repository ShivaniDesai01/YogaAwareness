<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yoga Awareness — Fixed</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --accent:#2E8B57; --muted:#6b7280;
      --bg:#edf6f1; --surface:#eef6ee;
      --shadow-light: rgba(255,255,255,0.85);
      --shadow-dark: rgba(0,0,0,0.08);
      --green:#4caf50; --yellow:#ffca28; --max-width:980px;
    }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial;background:linear-gradient(180deg,var(--bg),#ffffff);color:#222}
    .app{max-width:var(--max-width);margin:12px auto;border-radius:14px;overflow:hidden;background:var(--surface);box-shadow:12px 12px 28px var(--shadow-dark),-12px -12px 28px var(--shadow-light)}
    header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--surface);border-bottom:1px solid rgba(0,0,0,0.03);box-shadow: inset 2px 2px 6px rgba(0,0,0,0.02), inset -2px -2px 6px rgba(255,255,255,0.7)}
    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{font-size:18px;margin:0;color:var(--accent)}
    .icon-btn{background:var(--surface);border:none;font-size:18px;padding:8px;border-radius:10px;cursor:pointer;box-shadow:6px 6px 12px var(--shadow-dark),-6px -6px 12px var(--shadow-light);transition: all .16s ease}
    .icon-btn:hover{transform: translateY(-3px);box-shadow: inset 2px 2px 6px rgba(0,0,0,0.04), inset -2px -2px 6px rgba(255,255,255,0.6)}
    main{padding:16px;min-height:560px}
    .hidden{display:none}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .card{background:var(--surface);padding:12px;border-radius:12px;box-shadow:6px 6px 14px var(--shadow-dark),-6px -6px 14px var(--shadow-light)}
    .bottom-nav{display:flex;justify-content:space-around;padding:10px 12px;border-top:1px solid rgba(0,0,0,0.03);background:var(--surface);box-shadow: inset 2px 2px 6px rgba(0,0,0,0.02), inset -2px -2px 6px rgba(255,255,255,0.7);position:sticky;bottom:0}
    .nav-item{display:flex;flex-direction:column;align-items:center;font-size:12px;color:#555;cursor:pointer;padding:8px;border-radius:10px}
    .nav-item.active{color:var(--accent);box-shadow: inset 3px 3px 8px rgba(0,0,0,0.04), inset -3px -3px 8px rgba(255,255,255,0.6)}
    .pill{display:inline-block;padding:6px 10px;border-radius:20px;background:rgba(46,139,87,0.12);color:var(--accent);font-weight:600;box-shadow: inset 1px 1px 2px rgba(0,0,0,0.02), inset -1px -1px 2px rgba(255,255,255,0.6)}
    .big-btn{background: linear-gradient(180deg,var(--accent), #227a53);color:#fff;padding:10px 14px;border:none;border-radius:10px;cursor:pointer;box-shadow:6px 8px 18px rgba(0,0,0,0.12),-6px -6px 18px rgba(255,255,255,0.04);transition: transform .12s, box-shadow .12s}
    .big-btn.secondary{background:#ff7043}
    .big-btn.gray{background:#999;color:#fff;box-shadow:none}
    input,textarea,select{background:var(--surface);border:none;border-radius:10px;padding:8px;outline:none;box-shadow: inset 4px 6px 10px rgba(0,0,0,0.03), inset -4px -6px 10px rgba(255,255,255,0.65);width:100%}
    textarea{min-height:64px}
    .small{font-size:13px;color:var(--muted)}
    .calendar{width:100%;max-width:640px;margin:0 auto}
    .cal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cal-cell{padding:10px;background:var(--surface);border-radius:8px;min-height:64px;box-shadow:6px 6px 10px rgba(0,0,0,0.04),-6px -6px 10px rgba(255,255,255,0.6);display:flex;flex-direction:column;justify-content:space-between}
    .date-num{font-weight:700}
    .complete{background:linear-gradient(180deg,#eaf8ee,#e1f4e7)}
    .partial{background:linear-gradient(180deg,#fff9ea,#fff4d5)}
    .none{background:var(--surface)}
    .today-badge{font-size:12px;color:var(--accent);font-weight:700}
    @media (max-width:520px){ main{padding:12px} .grid{grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); } }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="brand">
        <button class="icon-btn" id="profileBtn" title="Profile"><i class="fa-regular fa-user"></i></button>
        <div>
          <h1 id="appName">Yoga Awareness</h1>
          <div class="small">30 poses • Morning / Stretch / Relax</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="icon-btn" id="reminderBtn" title="Set reminder"><i class="fa-regular fa-bell"></i></button>
        <button class="icon-btn" id="uploadNavBtn" title="Upload pose"><i class="fa-regular fa-square-plus"></i></button>
      </div>
    </header>

    <main>
      <!-- HOME -->
      <section id="homePage">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="pill" id="streakBadge">Streak: 0</div>
              <div class="small" style="margin-top:6px">Yoga improves flexibility, breathing, and calmness. Suggested daily time: 30 min.</div>
            </div>
            <div class="small">Time limit: 30 min</div>
          </div>
        </div>

        <h3 style="margin-top:14px">Morning</h3>
        <div id="morningList" class="grid"></div>

        <h3 style="margin-top:8px">Stretch</h3>
        <div id="stretchList" class="grid"></div>

        <h3 style="margin-top:8px">Relax</h3>
        <div id="relaxList" class="grid"></div>
      </section>

      <!-- SESSION -->
      <section id="sessionPage" class="hidden">
        <div class="card">
          <h3>Today's Session</h3>
          <div class="small">Suggested 5 poses. Tick when done. Press COMPLETE to mark today's progress.</div>
        </div>

        <div id="sessionList" class="grid" style="margin-top:12px"></div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="big-btn" id="completeSessionBtn">Complete Session</button>
          <button class="big-btn secondary" id="startTimerBtn">Start 30 min Timer</button>
        </div>

        <div style="margin-top:12px" class="card">
          <h4>Leave a review</h4>
          <textarea id="reviewTextSession" placeholder="How was your session?"></textarea>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button class="big-btn" id="saveReviewBtnSession">Save Review</button>
          </div>
        </div>
      </section>

      <!-- CALENDAR -->
      <section id="calendarPage" class="hidden">
        <div class="card calendar">
          <div class="cal-head">
            <div style="display:flex;gap:8px;align-items:center">
              <button class="icon-btn" id="prevMonth" title="Previous month"><i class="fa-regular fa-chevron-left"></i></button>
              <div id="calTitle" style="font-weight:700"></div>
              <button class="icon-btn" id="nextMonth" title="Next month"><i class="fa-regular fa-chevron-right"></i></button>
            </div>
            <div class="small">Green = done • Yellow = partial • White = none</div>
          </div>

          <div class="cal-grid" id="calGrid">
            <!-- weekdays + days rendered in JS -->
          </div>
        </div>

        <div id="dayEditorModal" class="card" style="margin-top:12px;display:none">
          <h4>Edit day</h4>
          <div id="editingDate" class="small"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="big-btn gray" id="markNoneBtn">Not Done</button>
            <button class="big-btn" id="markPartialBtn" style="background:var(--yellow);color:#000">Partial</button>
            <button class="big-btn" id="markCompleteBtn" style="background:var(--green)">Complete</button>
          </div>
        </div>
      </section>

      <!-- UPLOAD / ADMIN -->
      <section id="uploadPage" class="hidden">
        <div class="card">
          <h3>Upload Pose (admin)</h3>
          <div class="small">Add name, category (morning/stretch/relax) and short info. Stored locally in the browser.</div>
          <div style="margin-top:8px;display:grid;gap:8px">
            <input id="poseName" placeholder="Pose name" />
            <select id="poseCategory">
              <option value="morning">Morning</option>
              <option value="stretch">Stretch</option>
              <option value="relax">Relax</option>
            </select>
            <textarea id="poseInfo" placeholder="Short info (one sentence)"></textarea>
            <div style="display:flex;gap:8px">
              <button class="big-btn" id="addPoseBtn">Add Pose</button>
              <button class="big-btn gray" id="resetSampleBtn" style="box-shadow:none">Reset Sample Data</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ANALYSIS -->
      <section id="analysisPage" class="hidden">
        <div class="card">
          <h3>Analysis</h3>
          <div id="statsArea" class="small"></div>
        </div>

        <div style="margin-top:12px" class="card">
          <h4>Leave a review</h4>
          <textarea id="reviewText" placeholder="Type your review here..."></textarea>
          <div style="margin-top:8px">
            <button class="big-btn" id="saveReviewBtn">Save Review</button>
          </div>
        </div>

        <div style="margin-top:12px" class="card">
          <h4>Recent reviews</h4>
          <div id="reviewsList"></div>
        </div>
      </section>
    </main>

    <nav class="bottom-nav">
      <div class="nav-item active" id="navHome"><i class="fa-solid fa-house"></i><div>Home</div></div>
      <div class="nav-item" id="navSession"><i class="fa-solid fa-dumbbell"></i><div>Session</div></div>
      <div class="nav-item" id="navCalendar"><i class="fa-regular fa-calendar"></i><div>Calendar</div></div>
      <div class="nav-item" id="navAnalysis"><i class="fa-regular fa-chart-bar"></i><div>Analysis</div></div>
    </nav>
  </div>

<script>
/* Helper selectors */
const q = (s, el=document) => el.querySelector(s);
const qq = (s, el=document) => Array.from(el.querySelectorAll(s));
const todayISO = () => (new Date()).toISOString().slice(0,10);

/* Seed: 30 poses (no images) */
const seedPoses = (()=>{
  const names = [
    // Morning (10)
    "Sun Salutation","Mountain Pose","Chair Pose","Revolved Chair","Downward Dog",
    "Low Lunge","Child's Pose","Cat-Cow","Happy Baby","Boat Pose",
    // Stretch (10)
    "Seated Forward Bend","Legs-Up-the-Wall","Reclining Bound Angle","Camel Pose","Cow-Face Pose",
    "Triangle Pose","Bridge Pose","Butterfly Pose","Half Lord of the Fishes","Tree Pose",
    // Relax (10)
    "Corpse Pose","Wide-Knee Child’s Pose","Reclining Pigeon","Reclining Hand-to-Big-Toe","Half-Pigeon",
    "Seated Forward Bend (Relax)","Corpse Rest / Breath","Legs-Up-the-Wall (Relax)","Supported Bridge","Standing Forward Bend"
  ];
  const infos = [
    "Energizing flow to warm up body.",
    "Foundational pose for posture and balance.",
    "Strengthens legs, builds heat.",
    "Twisting variation to detoxify.",
    "Full-body stretch and circulation boost.",
    "Hip opener to increase mobility.",
    "Soothing rest and lower back release.",
    "Spinal warm-up for flexibility.",
    "Playful hip and back opening.",
    "Core-strengthening seated pose.",
    "Calms mind, stretches hamstrings.",
    "Gentle inversion to relieve legs.",
    "Restorative hip opener.",
    "Chest opener and backbend.",
    "Stretches shoulders and hips.",
    "Lateral stretch and alignment.",
    "Spinal release and back strengthening.",
    "Inner thigh and hip opener.",
    "Spinal twist and massage.",
    "Balance and focus in a grounding stance.",
    "Deep relaxation and integration.",
    "Very gentle full-body stretch and grounding.",
    "Hip release in a supported position.",
    "Hamstring stretch with ease.",
    "Deep hip opening pose.",
    "Soothing forward fold.",
    "Stillness and inner calm.",
    "Calming inversion for stress relief.",
    "Backbend with gentle support.",
    "Nervous system calming fold."
  ];
  return names.map((n,i)=>({
    id: 'p'+(i+1),
    category: i<10 ? 'morning' : (i<20 ? 'stretch' : 'relax'),
    name: n,
    info: infos[i] || ''
  }));
})();

/* Database in localStorage */
let DB = { poses: [], completions: {}, reviews: [], profile: { name: '' } };

function loadData(){
  const raw = localStorage.getItem('yogaAwarenessData');
  if(raw){
    try { DB = JSON.parse(raw); }
    catch(e){ DB = { poses: seedPoses.slice(), completions: {}, reviews: [], profile: { name: '' } }; saveData(); }
  } else {
    DB.poses = seedPoses.slice();
    DB.completions = {}; DB.reviews = []; DB.profile = { name: '' };
    saveData();
  }
}
function saveData(){ localStorage.setItem('yogaAwarenessData', JSON.stringify(DB)); }

/* Render Home - only names & info (no images) */
function renderHome(){
  const byCat = { morning: [], stretch: [], relax: [] };
  DB.poses.forEach(p => byCat[p.category]?.push(p));
  const renderList = (id, arr) => {
    const container = q(`#${id}List`);
    container.innerHTML = '';
    arr.forEach(p => {
      const card = document.createElement('div'); card.className = 'card';
      card.innerHTML = `
        <div style="display:flex;flex-direction:column;gap:6px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">${p.name}</div>
            <button class="icon-btn add-to-today" data-id="${p.id}" title="Add to today's session"><i class="fa-regular fa-plus"></i></button>
          </div>
          <div class="small">${p.info}</div>
        </div>
      `;
      card.querySelector('.add-to-today').onclick = ()=>addToToday(p.id);
      container.appendChild(card);
    });
  };
  renderList('morning', byCat.morning);
  renderList('stretch', byCat.stretch);
  renderList('relax', byCat.relax);
  q('#streakBadge').innerText = 'Streak: ' + computeStreak();
}

/* Today's session logic */
function getTodaysSession(){
  const today = todayISO();
  if(DB.completions[today] && DB.completions[today].sessionList){
    return DB.completions[today].sessionList.map(id => DB.poses.find(p=>p.id===id)).filter(Boolean);
  }
  const arr = DB.poses.slice(0,5);
  const ids = arr.map(p=>p.id);
  DB.completions[today] = DB.completions[today] || {};
  DB.completions[today].sessionList = ids;
  saveData();
  return arr;
}

function addToToday(poseId){
  const today = todayISO();
  DB.completions[today] = DB.completions[today] || {};
  DB.completions[today].sessionList = DB.completions[today].sessionList || [];
  if(!DB.completions[today].sessionList.includes(poseId)) DB.completions[today].sessionList.push(poseId);
  saveData();
  alert('Added pose to today’s session');
  renderSession();
}

function renderSession(){
  const list = getTodaysSession();
  const container = q('#sessionList'); container.innerHTML = '';
  list.forEach(p => {
    const row = document.createElement('div'); row.className = 'card';
    const checked = DB.completions[todayISO()]?.donePoses?.includes(p.id) ? 'checked' : '';
    row.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:700">${p.name}</div>
          <div class="small">${p.info}</div>
        </div>
        <div style="text-align:center">
          <label class="small">Done</label><br>
          <input type="checkbox" class="poseCheck" data-id="${p.id}" ${checked} />
        </div>
      </div>
    `;
    container.appendChild(row);
  });
  // wire checkboxes after injecting them
  qq('.poseCheck').forEach(cb=>{
    cb.onchange = ()=>{
      const id = cb.dataset.id;
      DB.completions[todayISO()] = DB.completions[todayISO()] || {};
      DB.completions[todayISO()].donePoses = DB.completions[todayISO()].donePoses || [];
      if(cb.checked){
        if(!DB.completions[todayISO()].donePoses.includes(id)) DB.completions[todayISO()].donePoses.push(id);
      } else {
        DB.completions[todayISO()].donePoses = DB.completions[todayISO()].donePoses.filter(x=>x!==id);
      }
      saveData();
      q('#streakBadge').innerText = 'Streak: ' + computeStreak();
    };
  });
}

/* Complete session button */
q('#completeSessionBtn').onclick = ()=>{
  const today = todayISO();
  const done = DB.completions[today]?.donePoses?.length || 0;
  const total = DB.completions[today]?.sessionList?.length || 5;
  if(done===0 && !confirm("You haven't ticked any poses. Mark today as not done?")) return;
  const status = (done===total) ? 'complete' : (done>0 ? 'partial' : 'none');
  DB.completions[today] = DB.completions[today] || {};
  DB.completions[today].status = status;
  saveData();
  alert('Today marked: ' + status);
  q('#streakBadge').innerText = 'Streak: ' + computeStreak();
  renderCalendar();
};

/* Timer */
q('#startTimerBtn').onclick = ()=>{
  const minutes = 30;
  if(!confirm(`Start a ${minutes} minute reminder? (for demo you can cancel)`)) return;
  setTimeout(()=> alert('Yoga Timer finished — nice job!'), minutes*60*1000);
  alert('Timer started');
};

/* Session review (session page) */
q('#saveReviewBtnSession').onclick = ()=>{
  const t = q('#reviewTextSession').value.trim();
  if(!t){ alert('Write something first'); return; }
  DB.reviews.unshift({date: todayISO(), text: t});
  if(DB.reviews.length>50) DB.reviews.pop();
  saveData();
  q('#reviewTextSession').value='';
  alert('Thanks for review');
  renderAnalysis();
};

/* Calendar */
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

function renderCalendar(){
  const grid = q('#calGrid');
  grid.innerHTML = `
    <div class="small" style="text-align:center;font-weight:700">Sun</div><div class="small" style="text-align:center;font-weight:700">Mon</div>
    <div class="small" style="text-align:center;font-weight:700">Tue</div><div class="small" style="text-align:center;font-weight:700">Wed</div>
    <div class="small" style="text-align:center;font-weight:700">Thu</div><div class="small" style="text-align:center;font-weight:700">Fri</div>
    <div class="small" style="text-align:center;font-weight:700">Sat</div>
  `;
  const first = new Date(currentYear, currentMonth, 1);
  const startDay = first.getDay();
  const daysInMonth = new Date(currentYear, currentMonth+1, 0).getDate();
  q('#calTitle').innerText = first.toLocaleString(undefined, {month:'long', year:'numeric'});
  for(let i=0;i<startDay;i++){
    const cell = document.createElement('div'); cell.className='cal-cell none'; grid.appendChild(cell);
  }
  for(let d=1; d<=daysInMonth; d++){
    const dateISO = new Date(currentYear, currentMonth, d).toISOString().slice(0,10);
    const status = DB.completions[dateISO]?.status || 'none';
    const cell = document.createElement('div');
    cell.className = 'cal-cell ' + (status==='complete' ? 'complete' : (status==='partial' ? 'partial' : 'none'));
    cell.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div class="date-num">${d}</div>${dateISO===todayISO() ? '<div class="today-badge">Today</div>' : ''}</div>
      <div class="small" style="margin-top:6px">${status==='complete' ? 'Completed' : (status==='partial' ? 'Partial' : '')}</div>`;
    cell.onclick = ()=> openDayEditor(dateISO);
    grid.appendChild(cell);
  }
}

/* Day editor */
function openDayEditor(dateISO){
  q('#dayEditorModal').style.display='block';
  q('#editingDate').innerText = dateISO;
  q('#markCompleteBtn').onclick = ()=>{ setDayStatus(dateISO,'complete'); q('#dayEditorModal').style.display='none'; };
  q('#markPartialBtn').onclick = ()=>{ setDayStatus(dateISO,'partial'); q('#dayEditorModal').style.display='none'; };
  q('#markNoneBtn').onclick = ()=>{ setDayStatus(dateISO,'none'); q('#dayEditorModal').style.display='none'; };
}
function setDayStatus(dateISO, status){
  DB.completions[dateISO] = DB.completions[dateISO] || {};
  DB.completions[dateISO].status = status;
  saveData();
  renderCalendar();
  q('#streakBadge').innerText = 'Streak: ' + computeStreak();
}
q('#prevMonth').onclick = ()=>{ currentMonth--; if(currentMonth<0){ currentMonth=11; currentYear--; } renderCalendar(); }
q('#nextMonth').onclick = ()=>{ currentMonth++; if(currentMonth>11){ currentMonth=0; currentYear++; } renderCalendar(); }

/* Upload page */
function renderUpload(){
  q('#poseName').value=''; q('#poseInfo').value=''; q('#poseCategory').value='morning';
}
q('#addPoseBtn').onclick = ()=>{
  const name = q('#poseName').value.trim();
  const cat = q('#poseCategory').value;
  const info = q('#poseInfo').value.trim() || '';
  if(!name){ alert('Give a name'); return; }
  const id = 'p'+(Date.now()%1000000);
  DB.poses.unshift({id, category: cat, name, info});
  saveData();
  alert('Pose added');
  renderHome();
  showPage('homePage');
};
q('#resetSampleBtn').onclick = ()=>{ if(confirm('Reset to original sample 30 poses?')){ DB.poses = seedPoses.slice(); saveData(); renderHome(); } };

/* Analysis (reviews & stats) */
function renderAnalysis(){
  const completed = Object.keys(DB.completions).filter(d=>DB.completions[d].status==='complete').length;
  const partial = Object.keys(DB.completions).filter(d=>DB.completions[d].status==='partial').length;
  const total = Object.keys(DB.completions).length;
  q('#statsArea').innerText = `Total days recorded: ${total} • Completed: ${completed} • Partial: ${partial} • Longest streak: ${computeLongestStreak()}`;
  const ul = q('#reviewsList'); ul.innerHTML = '';
  DB.reviews.slice(0,50).forEach(r=>{
    const div = document.createElement('div'); div.className='card'; div.style.marginBottom='8px';
    div.innerHTML = `<div style="font-weight:700">${r.date}</div><div class="small" style="margin-top:6px">${r.text}</div>`;
    ul.appendChild(div);
  });
}

/* Analysis page review input (main analysis) */
q('#saveReviewBtn').onclick = ()=>{
  const t = q('#reviewText').value.trim();
  if(!t) return alert('Write something first');
  DB.reviews.unshift({date: todayISO(), text: t});
  if(DB.reviews.length>50) DB.reviews.pop();
  saveData();
  q('#reviewText').value='';
  renderAnalysis();
};

/* Streak calculations */
function computeStreak(){
  let count = 0; let d = new Date();
  while(true){
    const iso = d.toISOString().slice(0,10);
    if(DB.completions[iso]?.status === 'complete'){ count++; d.setDate(d.getDate()-1); }
    else break;
  }
  return count;
}
function computeLongestStreak(){
  const dates = Object.keys(DB.completions).sort();
  let best = 0, cur = 0, last = null;
  for(const date of dates){
    const s = DB.completions[date].status;
    if(s === 'complete'){
      if(last && (new Date(date) - new Date(last) === 86400000)) cur++; else cur = 1;
      best = Math.max(best, cur);
      last = date;
    } else { last = date; cur = 0; }
  }
  return best;
}

/* Profile & reminder */
q('#profileBtn').onclick = ()=>{
  const name = prompt('Enter your name', DB.profile.name || '');
  if(name !== null){ DB.profile.name = name; saveData(); alert('Saved'); }
};
q('#reminderBtn').onclick = ()=>{
  const mins = prompt('Set reminder in minutes (demo: enter 0.1 for 6 seconds)', '30');
  if(!mins) return;
  const ms = parseFloat(mins) * 60 * 1000;
  setTimeout(()=> alert('Reminder: time for yoga!'), ms);
  alert('Reminder set');
};

/* Navigation */
function showPage(pageId){
  ['homePage','sessionPage','calendarPage','uploadPage','analysisPage'].forEach(id=>{
    const el = q('#'+id);
    if(el) el.classList.toggle('hidden', id !== pageId);
  });
  ['navHome','navSession','navCalendar','navAnalysis'].forEach(id=>{
    const el = q('#'+id);
    if(el) el.classList.toggle('active', id.toLowerCase().includes(pageId.replace('Page','').toLowerCase()));
  });
  if(pageId === 'homePage') renderHome();
  if(pageId === 'sessionPage') renderSession();
  if(pageId === 'calendarPage') renderCalendar();
  if(pageId === 'uploadPage') renderUpload();
  if(pageId === 'analysisPage') renderAnalysis();
}

/* Bottom nav wiring + upload icon */
q('#navHome').onclick = ()=> showPage('homePage');
q('#navSession').onclick = ()=> showPage('sessionPage');
q('#navCalendar').onclick = ()=> showPage('calendarPage');
q('#navAnalysis').onclick = ()=> showPage('analysisPage');
q('#uploadNavBtn').onclick = ()=> showPage('uploadPage');

/* Initialize */
loadData();
showPage('homePage');
renderCalendar();
renderAnalysis();
</script>
</body>
</html>